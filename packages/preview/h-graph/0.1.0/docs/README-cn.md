# H-Graph

H-Graph æ˜¯ä¸€ä¸ªåŸºäº [Typst](https://typst.app/) çš„ç®€æ´å›¾æè¿°è¯­è¨€, å¯ä»¥è§£æä¿¡æ¯ä½œä¸ºèŠ‚ç‚¹å’Œè¾¹, ä»¥åŠä¸€äº›æ¸²æŸ“çš„å‚æ•°. åŒæ—¶è‡ªå¸¦ä¸€ä¸ªæ¸²æŸ“åç«¯, ä½¿ç”¨[fletcher](https://typst.app/universe/package/fletcher)
å®ƒè®©ä½ ç”¨æç®€çš„ DSL æè¿°å›¾çš„ **èŠ‚ç‚¹ã€è¾¹ã€å†…å®¹**ï¼Œå¹¶ä¸”æ”¯æŒ **è‡ªå®šä¹‰æ¸²æŸ“å™¨** æ¥çµæ´»å¸ƒç½®ä½ç½®.

## âœ¨ ç‰¹æ€§

* ç®€å•ç›´è§‚çš„è¯­æ³•ï¼š`A - B;` å°±æ˜¯ä¸€æ¡è¾¹, æ— éœ€æå‰å£°æ˜(å½“ç„¶å¯ä»¥æå‰å£°æ˜).
* èŒƒå›´ä¸å±•å¼€ï¼š`A.Z;` è‡ªåŠ¨ç”Ÿæˆä¸€ç»„èŠ‚ç‚¹`A,B,C...Z`, `A.C - A1-B12`.å°±æ˜¯å·¦å³ä¸¤ä¸¤éƒ½è¿çº¿.
* å®æ›¿æ¢ï¼š`|...|`ä¸­çš„å†…å®¹ä½œä¸ºå®, ç³»ç»Ÿå†…ç½®ä¸‹åˆ’çº¿å¼€å¤´çš„ç¼–è¯‘å±•å¼€çš„å®, æ¸²æŸ“å™¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ¸²æŸ“æ—¶å±•å¼€çš„å®. å¦‚`A: [hello, i am $|_name|$];`, `|_name|`è¢«æ›¿æ¢ä¸ºè¿™ä¸ªèŠ‚ç‚¹åå­—ï¼Œ ç»“åˆåç§°å±•å¼€å¯å®ç°è‡ªå®šä¹‰çš„ä¸ªæ€§åŒ–æ˜¾ç¤º
* å…ƒä¿¡æ¯æ§åˆ¶ï¼šè‡ªç¯ã€å¤šé‡è¾¹çš„æ˜¯å¦å¯ç”¨
* è‡ªå®šä¹‰æ¸²æŸ“ï¼šæä¾› `polar-render`ï¼ˆæåæ ‡ç¯å½¢ï¼‰ä¸ `tree-render`ï¼ˆæ ‘çŠ¶å¸ƒå±€ï¼‰, ä½ ä¹Ÿå¯ä»¥åªç”¨è¯­è¨€è§£æå™¨,ç„¶åè‡ªå®šä¹‰æ¸²æŸ“å™¨.

---
## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### 1.åˆ©ç”¨`raw`æ›¿æ¢:
```typst

#import #import "@preview/h-graph:0.1.0"

#show raw.where(lang: "graph"): enable-graph-in-raw(polar-render)
// or #show raw.where(lang: "graph"): enable-graph-in-raw(tree-render)
```graph
#scl: 0.8;
1-2, 3, 4;
5-6, 7, 8;
2- 3, 4;
6 - 7, 8;
3 > 7;
4- 8;
```
```

### 2. æ›´çµæ´»çš„ä½¿ç”¨
```typst
// first parse the code and get info
#let infos = h-graph-parser("A.C; B-A;")
// use render to display
#let (nodes, edges, render_args) = infos
#tree-render(
  ..render_args,
)(nodes: nodes, edges: edges)

// æˆ–è€…æ›´åŠ ç®€å•
#h-graph("A.C; B-A;", tree-render)
```
---
## ğŸ“· ç¤ºä¾‹
![tree-render çš„ç¤ºä¾‹](./img/demo1.png)
![æ›´å¤šç¤ºä¾‹](./img/demo2.png)
![](./img/demo3.png)
![](./img/demo4.png)
![ä¸€äº›å‚æ•°](./img/demo5.png)
![å¥‡å¦™çš„æ•ˆæœ](./img/demo6.png)

---
## âš™ï¸ è¯­è¨€è§„åˆ™

`h-graph`è¯­è¨€çš„åŸºæœ¬å•å…ƒæ˜¯è¯­å¥, æ¯ä¸ªè¯­å¥éƒ½å¼ºåˆ¶ç”¨åˆ†å·éš”å¼€.
åœ¨`h-graph`è¯­è¨€é‡Œé¢, é™¤äº†å†…å®¹å£°æ˜è¯­å¥å¤–, æ— æ³•ä½¿ç”¨`";", ":", "-", ","`, è¯·ä½¿ç”¨å…¶ä»–ç¬¦å·.
`h-graph`çš„è¿è¡Œæµç¨‹æ˜¯:
```
è§£æh-graphè¯­è¨€ç”ŸæˆèŠ‚ç‚¹è¾¹å’Œå…ƒä¿¡æ¯(ç¼–è¯‘æ—¶) --> ä¼ å…¥renderæ¸²æŸ“(æ¸²æŸ“æ—¶)
```

### 1. èŠ‚ç‚¹çš„åç§°å•å…ƒ

```h-graph
A; 
B; 
A.C, 1.10, Node;
```
ä¸¤ä¸ªåå­—ä¸­é—´å¦‚æœç”¨`.`è¿æ¥ä¼šè¢«è‡ªåŠ¨å±•å¼€, å±•å¼€æ˜¯å­—æ¯å’Œæ•°å­—ä¸€ä¸€å¯¹åº”çš„å±•å¼€.
å¦‚`1.10`, `A.C`å°±æ˜¯`1,2,3...10`, `A,B,C`ï¼Œ `A1.A3`å°±æ˜¯`A1, A2, A3`.

èŒƒå›´å±•å¼€ï¼Œ å•ä¸ªåç§°ç­‰ç­‰å¯ä»¥ç”¨é€—å·éš”å¼€ï¼Œ å…±åŒç»„æˆ **åç§°å•å…ƒ**.
åç§°å•å…ƒå¯ä»¥ç‹¬ç«‹æˆå¥, ç›¸å½“äºæ²¡æœ‰è¾¹çš„èŠ‚ç‚¹.

### 2.è¾¹
è¯­å¥[è¾¹å£°æ˜],
åˆ©ç”¨`-`, `>`, `-`, `-...-`ä½œä¸ºä¸­ç¼€è¿æ¥ä¸¤ä¸ª**åç§°å•å…ƒ**å³å£°æ˜äº†è¾¹.
```
A.C - A.C;
1,2, 10.20 - A;
E > D;
D > A;
A < C;
A - bend: 30deg, "-|>" - D;
```
`-`æ˜¯çº¯ç›´çº¿è¿æ¥, `>` `<`åˆ†åˆ«å¸¦æœ‰ä»å·¦åˆ°å³çš„ç®­å¤´å’Œä»å³åˆ°å·¦çš„ç®­å¤´.
ä½¿ç”¨`-..-`å¯ä»¥å£°æ˜è¾¹å±æ€§, å¦‚æœè¿™ä¸ªå±æ€§æ˜¯`key:value`, ä½œä¸ºå­—å…¸å‚æ•°, å¦åˆ™æ˜¯æ•°ç»„å‚æ•°.ç„¶ååœ¨æ¸²æŸ“çš„æ—¶å€™ä¼ å…¥`fletcher`çš„`edge`ä½œä¸ºå‚æ•°, å¯ä»¥æŸ¥çœ‹fletcheræ‰‹å†Œçœ‹å¸¸ç”¨å‡½æ•°. æˆ‘ä»¬è§„å®šå­—å…¸å‚æ•°ä»¥`_`å¼€å¤´çš„ä½œä¸ºç§æœ‰å‚æ•°, ä¼šè¢«æ¸²æŸ“å™¨æ‹¦æˆªä½œä¸ºæ¸²æŸ“å™¨çš„å‚æ•°æ¥æä¾›é’ˆå¯¹æ¸²æŸ“å™¨çš„æ¸²æŸ“æ—¶.

`-..-`å†…éƒ¨ä½¿ç”¨`,`å’Œ`:`éœ€è¦è½¬ä¹‰: `\,`, `\:`.

`-..-`é‡Œæä¾›ä¸¤ä¸ªå®, åœ¨ç¼–è¯‘æ—¶æ›¿æ¢, `|_from|`, `|_to|`, åˆ†åˆ«è¡¨ç¤ºå½“å‰è¾¹å·¦ä¾§å’Œå³ä¾§çš„èŠ‚ç‚¹çš„åç§°.
å¦‚
```
A - bend: 30deg, "-|>", [|_from| -> |_to|'s' content is $a + b = c$] - D;
```
è¡¨ç¤ºè¿™ä¸ªè¾¹æœ‰30degçš„å¼¯æ›², æœ‰ç®­å¤´å½¢çŠ¶æ˜¯`-|>`, è¾¹ä¸Šæ˜¾ç¤ºå†…å®¹æ˜¯è¿™æ ·çš„typstå†…å®¹.

### 3.å†…å®¹å£°æ˜
ä¸€ä¸ªèŠ‚ç‚¹æ¸²æŸ“å™¨ä¸€èˆ¬é»˜è®¤æ˜¾ç¤ºä»–çš„åå­—, é™¤éä»–è¿›è¡Œäº†å†…å®¹å£°æ˜.
è¯­å¥[å†…å®¹å£°æ˜]é¦–å…ˆè¾“å…¥åç§°å•å…ƒ, ç„¶å`:`åé¢å°†ä¼šè¢«æ— æ¡ä»¶çš„è§£æä¸ºtypstä¸‹çš„æ˜¾ç¤ºå†…å®¹.
```
A.B, 1: [this is node];
```
å†…å®¹å£°æ˜è¯­å¥æ”¯æŒå®`|_name|`, è¡¨ç¤ºå½“å‰å†…å®¹èŠ‚ç‚¹çš„åç§°. æ¯”å¦‚
```
A.Z: $|_name|$;
```
è®©è¿™äº›èŠ‚ç‚¹çš„å†…å®¹æ˜¯æ•°å­¦æ¨¡å¼æ˜¾ç¤ºä»–ä»¬çš„åç§°.

### 4.å…ƒä¿¡æ¯
è¯­å¥[å…ƒä¿¡æ¯]æä¾›è§£æè¿è¡Œæ—¶çš„è‡ªå®šä¹‰è§£æé€‰é¡¹:
```
@noloop
```
* `@noloop;` ç¦æ­¢è‡ªç¯
* `@multi-edge;` å…è®¸å¤šé‡è¾¹
* `----` ä¸‹æ–¹è¯­å¥é‡ç½®å…ƒä¿¡æ¯

å¦‚
```
@noloop;
A-A;
```
å°†ä¸ä¼šæ˜¾ç¤ºè¿™ä¸ªè‡ªé€‰è¾¹.
```
@multi-edge;
A-B;
A-bend:30deg-B;
```
ä¼šæ˜¾ç¤ºä¸¤æ¡è¾¹.
å¦‚æœæ²¡æœ‰å¼€å¯é»˜è®¤åªä¼šæ˜¾ç¤ºä¸¤ä¸ªèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªè¢«å£°æ˜çš„è¾¹.
`----;`ä¼šé˜»æ–­ä¸Šæ–¹çš„æ‰€æœ‰ä¿¡æ¯, ä¸‹æ–¹å°±æ˜¯æ”¯æŒè‡ªç¯ä¸æ”¯æŒé‡è¾¹çš„é»˜è®¤ç¯å¢ƒ.
å¦‚å›¾
```
@noloop;
----;
A-A;
```
è¿˜æ˜¯ä¼šå­˜åœ¨è‡ªç¯.


### 5.æ¸²æŸ“å‚æ•°
è¯­å¥[æ¸²æŸ“å‚æ•°]æä¾›åœ¨æ–‡æœ¬é‡Œè‡ªå®šä¹‰æ¸²æŸ“æ—¶ä¼ å…¥æ¸²æŸ“å‡½æ•°çš„å‚æ•°
* ç”¨ `#key: value;` æ¥ä¼ é€’æ¸²æŸ“å‚æ•°ï¼Œæ¯”å¦‚ï¼š
```typst
#cir_n: 3;
#scl: 0.8;
```
æ‚¨æ°¸è¿œåªåº”è¯¥åœ¨åˆ©ç”¨`raw`ç¯å¢ƒå†™å…¥çš„`h-graph`ä»£ç é‡Œä½¿ç”¨, å› ä¸ºè¿™ä¸ªæ—¶å€™ä½ æ— æ³•ç›´æ¥è°ƒç”¨æ¸²æŸ“å™¨. å…¶ä»–æ—¶å€™ä½ å¯ä»¥å…ˆè§£æç„¶åç›´æ¥æ‰‹åŠ¨è°ƒç”¨æ¸²æŸ“å™¨å‡½æ•°å¹¶ä¸”æä¾›å‚æ•°.
å„ç§å‚æ•°å’Œæ¸²æŸ“å™¨ç›¸å…³.


## ğŸ¨ æ¸²æŸ“å™¨

H-Graph é»˜è®¤æä¾›ï¼š

#### ä»¥å›¾çš„ä¸»å¹²æ ‘å±•å¼€å¸ƒå±€
```
tree-render(
  scl: 1, // ç¼©æ”¾å¤§å°
  ed-bd: "30deg", // ä¸æ˜¯ä¸»å¹²ä¸Šçš„è¾¹çš„é»˜è®¤å¼¯æ›²å¼§åº¦
  min-space: "50pt", // æ¯æ¡è¾¹çš„é»˜è®¤è·ç¦»
  base-deg: "0", // æ•´ä½“çš„é€‰è½¬è§’åº¦
)
```
è¿™ä¸ªå‡½æ•°åŒæ—¶æ”¯æŒä¸€ä¸ªè¾¹çš„è‡ªå®šä¹‰å‚æ•°`_l`:
```h-graph
A-_l: 100pt-B;
```
æ„æ€æ˜¯è¿™æ¡è¾¹çš„é•¿åº¦è®¾ä¸º`100pt`, æ–¹ä¾¿è§£å†³ä¸€äº›é‡å æ—¶å€™çš„é—®é¢˜.

#### æŒ‰åŒå¿ƒåœ†åˆ†å¸ƒ
```
polar-render(
  cir_n: 1, // åŒå¿ƒåœ†å‚æ•°
  scl: 1, // ç¼©æ”¾
)
```

ä½ ä¹Ÿå¯ä»¥å†™è‡ªå·±çš„æ¸²æŸ“å™¨ï¼š

```typst
#let my-render(scl: 1) = (nodes: dictionary, edges: array) => {
  scl = int(scl) // å¦‚æœæ˜¯åœ¨ä»£ç é‡Œè®¾å®šçš„å‚æ•°, å‚æ•°æ˜¯å­—ç¬¦ä¸²,è¦ç»Ÿä¸€ä¸€ä¸‹
  diagram(
    ..nodes.keys().map((n, i) => node((i*20pt, 0), n, name: <n>)),
    // æˆ‘ä»¬æ¨èä½ ä½¿ç”¨render-help-draw-edgeç»˜åˆ¶è¾¹, è¿™ä¸ªè¾…åŠ©å‡½æ•°å¯ä»¥è‡ªåŠ¨è§£å†³ä¼ å…¥edgeçš„å‚æ•°çš„å†²çª
    ..edges.map(ed => render-help-draw-edge(ed: ed)), 
  )
}
```

ç„¶åè¿™æ ·ä½¿ç”¨ï¼š

```typst
#h-graph("A...D; A - B;", my-render)
```

---

## ğŸ“Œ TODO / æ‰©å±•

* [ ] æ›´å¤šå¸ƒå±€ç®—æ³•ï¼ˆforce-directed ç­‰ï¼‰
* [ ] èŠ‚ç‚¹æ ·å¼æ”¯æŒ
* [ ] å­å›¾ / åˆ†ç»„

---
